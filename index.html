<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>直播回放列表</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>作品 <span class="highlight">直播回看</span></h1>
  </header>

  <main id="replayContainer">
    <!-- 内容通过JS动态生成 -->
  </main>

  <!-- 访问量统计 -->
  <footer>
    <p>页面访问量：<span id="busuanzi_value_page_pv">加载中...</span></p>
    <p>网站总访问量：<span id="busuanzi_value_site_pv">加载中...</span></p>
  </footer>

  <!-- 引入 Busuanzi 统计脚本 -->
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  <script>
    const DATA_URL = 'https://raw.githubusercontent.com/feixiangmax1126/live-replay/main/data.json';

    fetch(DATA_URL)
      .then(res => res.json())
      .then(data => {
        data.sort((a, b) => (a.date < b.date ? 1 : -1));
        const groupedByMonth = {};
        data.forEach(item => {
          const monthKey = item.date.slice(0,7);
          if (!groupedByMonth[monthKey]) {
            groupedByMonth[monthKey] = [];
          }
          groupedByMonth[monthKey].push(item);
        });

        const container = document.getElementById('replayContainer');
        Object.keys(groupedByMonth).sort().reverse().forEach(monthKey => {
          const monthTitle = document.createElement('h2');
          monthTitle.textContent = monthKey;
          monthTitle.classList.add('month-title');
          container.appendChild(monthTitle);

          const replayGrid = document.createElement('div');
          replayGrid.classList.add('replay-grid');

          groupedByMonth[monthKey].forEach(replay => {
            const card = document.createElement('a');
            card.href = `player.html?url=${encodeURIComponent(replay.m3u8)}`;
            card.classList.add('replay-card');

            const img = document.createElement('img');
            img.src = replay.thumbnail;
            img.alt = replay.title;
            img.classList.add('replay-thumbnail');

            const titleOverlay = document.createElement('div');
            titleOverlay.classList.add('title-overlay');
            titleOverlay.textContent = `${replay.date} - ${replay.title}`;

            const infoBar = document.createElement('div');
            infoBar.classList.add('info-bar');

            const dateSpan = document.createElement('span');
            dateSpan.textContent = replay.date;

            const viewsSpan = document.createElement('span');
            viewsSpan.textContent = replay.views + ' 观看';

            infoBar.appendChild(dateSpan);
            infoBar.appendChild(viewsSpan);

            card.appendChild(img);
            card.appendChild(titleOverlay);
            card.appendChild(infoBar);
            replayGrid.appendChild(card);
          });

          container.appendChild(replayGrid);
        });
      })
      .catch(err => {
        console.error('数据加载失败:', err);
        document.getElementById('replayContainer').textContent = '无法加载回放数据，请稍后重试。';
      });
  </script>
</body>
</html>
